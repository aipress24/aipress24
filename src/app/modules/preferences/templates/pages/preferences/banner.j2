{% extends "pages/preferences/_base.j2" %}

{% block main %}
  <h2>Image de présentation</h2>

  <div class="pt-2">
    <form
        class="divide-y divide-gray-200 lg:col-span-9"
        action=""
        method="POST"
        enctype="multipart/form-data"
    >
    <div class="mb-4">
    <div class="font-semibold mb-1">Image actuelle</div>
    <div id="imageContainer" class="p-2 flex items-center justify-center min-h-[120px]">
    {% if current_image_url and current_image_url != 'None' %}
        <img
            id="currentImage"
            src="{{ current_image_url }}"
            alt="Image de présentation actuelle"
            class="h-32 w-full object-cover lg:h-48 max-w-full max-h-[200px]"
            style="max-height: 250px;"
        />
    {% else %}
      <p class="text-gray-500">Aucune image.</p>
    {% endif %}
    </div>
    </div>

    <div class="pt-4">
      <div class="mb-2 font-semibold">
        Charger une nouvelle image
      </div>
    <input
        type="file"
        id="image"
        name="image"
        accept=".png,.jpeg,.jpg,image/png,image/jpeg"
        class="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none"
    />
    <p class="mt-1 text-sm text-gray-500">PNG, JPG, JPEG (Max 4MB)</p>
    </div>

      <div class="mt-4 py-4 px-4 flex justify-end sm:px-6">
        <button
            type="submit"
            name="submit"
            value="cancel"
            class="bg-white border border-gray-300 rounded-md shadow-sm py-2 px-4 inline-flex justify-center text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500"
        >
          Cancel
        </button>
        <button
            type="submit"
            name="submit"
            value="save"
            class="ml-5 bg-sky-700 border border-transparent rounded-md shadow-sm py-2 px-4 inline-flex justify-center text-sm font-medium text-white hover:bg-sky-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500"
        >
          Save
        </button>
      </div>
    </form>
  </div>
  <script>
      const imageInput = document.getElementById('image');
      const imageContainer = document.getElementById('imageContainer');

      imageInput.addEventListener('change', function(event) {
          // Get the selected file
          const file = event.target.files[0];

          if (file) {
              // Use FileReader to read the file locally
              const reader = new FileReader();

              reader.onload = function(e) {
                  // Check if an image element already exists (the current image)
                  let imgElement = document.getElementById('currentImage');

                  if (!imgElement) {
                      // If no current image, create a new image element for the preview
                      imgElement = document.createElement('img');
                      imgElement.id = 'currentImage';
                      imgElement.alt = 'Nouvelle image de présentation';
                      // Apply Tailwind-like classes for sizing/styling
                      imgElement.className = 'max-w-full max-h-[300px] rounded-md shadow-lg border-2 border-sky-500';
                      imgElement.style.maxHeight = '250px';

                      // Clear the container (removes the "Aucune image..." text)
                      imageContainer.innerHTML = '';
                      imageContainer.appendChild(imgElement);
                  } else {
                      // If current image exists, just update its classes to highlight the change
                      imgElement.classList.add('border-2', 'border-sky-500');
                  }

                  // Set the source to the read data URL (the image preview)
                  imgElement.src = e.target.result;
              };

              // Read the file as a Data URL (a base64 string)
              reader.readAsDataURL(file);
          }
      });
  </script>
{% endblock %}
